#!/bin/bash
# (_)_ __ ___ ___ _ __ ___ ___
# | | '_ \ / __/ _ \| '_ ` _ \/ _ \
# | | | | | (_| (_) | | | | | | __/
# |_|_| |_|\___\___/|_| |_| |_|___|
# income - Personal finance calc: income, rent, brackets CLI
# Author: galaxy-cli

print_income_breakdown() {
	local hour week month year
	hour=$1; week=$2; month=$3; year=$4
	printf "\nIncome Breakdown:"
	printf "\n \$%'d/hour" "$hour"
	printf "\n \$%'d/week" "$week"
	printf "\n \$%'d/month" "$month"
	printf "\n \$%'d/year\n\n" "$year"
}

get_positive_number() {
	local prompt var clean
	prompt=$1
	read -p "$prompt" var
	clean="${var//,/}"
	if [[ "$clean" =~ ^[0-9]+$ ]] && [ "$clean" -gt 0 ]; then
		echo "$clean"
	else
		echo "Invalid input. Please enter a positive number with commas allowed (e.g., 1,000). Exiting."
		exit 1
	fi
}

get_non_negative_number() {
	local prompt var clean
	prompt=$1
	read -p "$prompt" var
	clean="${var//,/}"
	if [[ "$clean" =~ ^[0-9]+$ ]]; then
		echo "$clean"
	else
		echo "Invalid input. Please enter a non-negative integer with commas allowed (0 or greater). Exiting."
		exit 1
	fi
}

get_percentage() {
	local prompt var clean
	prompt=$1
	read -p "$prompt" var
	clean="${var//,/}"
	clean="${clean//./}"  # Remove decimal for integer math
	if [[ "$clean" =~ ^[0-9]+$ ]] && [ "$clean" -ge 0 ] && [ "$clean" -le 100 ]; then
		echo "$clean"
	else
		echo "Invalid input. Please enter a percentage 0-100 (e.g., 10 for 10%). Exiting."
		exit 1
	fi
}

calculate_yearly_income() {
	echo "=== Yearly Income Calculator ==="
	year=$(get_positive_number "Annual income ($): ")
	hour=$((year/12/5/8))
	week=$((year/12/4))
	month=$((year/12))
	print_income_breakdown "$hour" "$week" "$month" "$year"
}

calculate_monthly_income() {
	echo "=== Monthly Income Calculator ==="
	hour=$(get_positive_number "Hourly wage ($): ")
	workweek=$(get_positive_number "Hours per week: ")
	week=$((hour*workweek))
	month=$((week*4))
	year=$((month*12))
	print_income_breakdown "$hour" "$week" "$month" "$year"
}

calculate_rent() {
	echo "=== Rent Calculator ==="
	rent=$(get_positive_number "Rent per month ($): ")
	income=$(get_positive_number "Income per month ($): ")
	roommates=$(get_non_negative_number "Number of roommates: ")
	total_people=$((roommates + 1))
	remains=$((income - (rent/total_people)))
	yearly=$((remains*12))
	percent=$((((rent/total_people)*100)/income))
	printf "\nAfter rent: \$%'d/month, \$%'d/year" "$remains" "$yearly"
	printf "\nRent is %d%% of income\n\n" "$percent"
}

calculate_income_bracket() {
	echo "=== Income Bracket Calculator ==="
	mid=$(get_positive_number "Middle class income bracket ($): ")
	work_p=$((mid/3))
	work=$((mid/2))
	lowmid=$(echo "scale=0; $mid/1.5" | bc)
	uppmid=$(echo "$mid*1.5" | bc)
	uppmid_int=$(printf "%.0f" "$uppmid")
	upp=$((mid*2))
	wel=$((mid*3))
	printf "\nCLASS BRACKET"
	printf "\nWorking Poor\n \$%'d/year -\n" "$work_p"
	printf "\nWorking\n \$%'d/year\n" "$work"
	printf "\nLower-Middle\n \$%'d/year\n" "$lowmid"
	printf "\nMiddle\n \$%'d/year\n" "$mid"
	printf "\nUpper-Middle\n \$%'d/year\n" "$uppmid_int"
	printf "\nUpper\n \$%'d/year\n" "$upp"
	printf "\nWealthly\n \$%'d/year +\n\n" "$wel"
}

calculate_investment() {
        echo "=== Investment Calculator ==="
        monthly_gross=$(get_positive_number "Monthly income? ($): ")
        takehome_pct=$(get_percentage "Take-home pay? (%): ")
        invest_pct=$(get_percentage "Amount invested? (% of take-home): ")
        save_pct=$(get_percentage "Amount saved? (% of take-home): ")

        monthly_takehome=$((monthly_gross * takehome_pct / 100))

        invested_from_takehome=$((monthly_takehome * invest_pct / 100))
        saved_from_takehome=$((monthly_takehome * save_pct / 100))

        monthly_discretionary=$((monthly_takehome - invested_from_takehome - saved_from_takehome))

        weekly_takehome=$((monthly_takehome / 4))
        yearly_takehome=$((monthly_takehome * 12))

        weekly_invested=$((invested_from_takehome / 4))
        yearly_invested=$((invested_from_takehome * 12))

        weekly_saved=$((saved_from_takehome / 4))
        yearly_saved=$((saved_from_takehome * 12))

        weekly_discretionary=$((monthly_discretionary / 4))
        yearly_discretionary=$((monthly_discretionary * 12))

        printf "\nTake-home pay (%d%% of monthly income):" "$takehome_pct"
        printf "\n \$%'d/month" "$monthly_takehome"
        printf "\n \$%'d/year\n" "$yearly_takehome"

        printf "\nInvested (%d%% of take-home):" "$invest_pct"
        printf "\n \$%'d/month" "$invested_from_takehome"
        printf "\n \$%'d/year\n" "$yearly_invested"

        printf "\nSaved (%d%% of take-home):" "$save_pct"
        printf "\n \$%'d/month" "$saved_from_takehome"
        printf "\n \$%'d/year\n" "$yearly_saved"

        printf "\nDiscretionary:"
        printf "\n \$%'d/month" "$monthly_discretionary"
        printf "\n \$%'d/year\n\n" "$yearly_discretionary"
}



print_help() {
	cat << EOF
USAGE
income [OPTIONS]

OPTIONS
--monthly-income      Calculate monthly income
--yearly-income       Calculate yearly income
--monthly-rent        Calculate rent affordability
--income-bracket      Calculate income brackets
--investment          Calculate investment allocation
--all                 Run all calculators interactively
--help                Show this help message

EXAMPLE
income --monthly-income --investment
EOF
}

if [[ $# -eq 0 ]]; then
	income -h
	exit 1
fi

while [[ $# -gt 0 ]]; do
	case "$1" in
	-h | --help)
		print_help
		exit 0
		;;
	--monthly-income)
		calculate_monthly_income
		shift
		;;
	--yearly-income)
		calculate_yearly_income
		shift
		;;
	--monthly-rent)
		calculate_rent
		shift
		;;
	--income-bracket)
		calculate_income_bracket
		shift
		;;
	--investment)
		calculate_investment
		shift
		;;
	--all)
		read -p "Calculate yearly income? [Y/N] " yearly
		[[ $yearly =~ [yY] ]] && calculate_yearly_income
		read -p "Calculate monthly income? [Y/N] " monthly
		[[ $monthly =~ [yY] ]] && calculate_monthly_income
		read -p "Calculate rent? [Y/N] " rent_choice
		[[ $rent_choice =~ [yY] ]] && calculate_rent
		read -p "Calculate income brackets? [Y/N] " bracket
		[[ $bracket =~ [yY] ]] && calculate_income_bracket
		read -p "Calculate investment? [Y/N] " invest_choice
		[[ $invest_choice =~ [yY] ]] && calculate_investment
		shift
		;;
	*)
		echo "Unknown option: $1"
		print_help
		exit 1
		;;
	esac
done
